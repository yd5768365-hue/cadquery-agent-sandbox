# å¤æ‚è£…é…ä½“ CAE è‡ªåŠ¨åŒ–ç³»ç»Ÿ - å¼€å‘éƒ¨ç½²æŒ‡å—

## ğŸ“ é¡¹ç›®ç»“æ„

```
E:\DeepSeek_Work\
â”œâ”€â”€ server.py                    # ä¸»ç¨‹åº(å»ºè®®ä¿å­˜)
â”œâ”€â”€ config.json                  # â† MCP é…ç½®æ–‡ä»¶(æ ¸å¿ƒæ–‡ä»¶å»ºè®®å¤‡ä»½)
â”œâ”€â”€ Dockerfile                   # â† dockeré…ç½®æ–‡ä»¶
â”œâ”€â”€ test/                        # å·¥ä½œç›®å½•ï¼ˆæŒ‚è½½åˆ°å®¹å™¨ï¼‰
â”‚   â”œâ”€â”€ input/                   # è¾“å…¥æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ assembly.step
â”‚   â”œâ”€â”€ parts/                   # æ‹†åˆ†åçš„é›¶ä»¶
â”‚   â”œâ”€â”€ meshes/                  # ç½‘æ ¼æ–‡ä»¶
â”‚   â”œâ”€â”€ analyses/                # CalculiX è¾“å…¥æ–‡ä»¶
â”‚   â””â”€â”€ results/                 # è®¡ç®—ç»“æœ
â””â”€â”€ scripts/                     # è¾…åŠ©è„šæœ¬ï¼ˆå¯é€‰ï¼‰
    â”œâ”€â”€ contact_detect.py
    â””â”€â”€ post_process.py
```

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆ5 æ­¥å®Œæˆï¼‰

### ç¬¬ 1 æ­¥ï¼šå‡†å¤‡æ–‡ä»¶

```bash
# åˆ›å»ºå·¥ä½œç›®å½•
cd E:\DeepSeek_Work
mkdir test\input test\parts test\meshes test\analyses test\results

# å°†ä»¥ä¸‹ 3 ä¸ªæ–‡ä»¶æ”¾åˆ° E:\DeepSeek_Work\
# 1. server.py (ä½¿ç”¨ä¼˜åŒ–ç‰ˆæœ¬)
# 2. Dockerfile (ä½¿ç”¨ä¼˜åŒ–ç‰ˆæœ¬)
# 3. config.json (æ–°å»ºé…ç½®æ–‡ä»¶)
```

### ç¬¬ 2 æ­¥ï¼šæ„å»º Docker é•œåƒ

```bash
# åœ¨ E:\DeepSeek_Work\ ç›®å½•ä¸‹æ‰§è¡Œ
docker build -t cae-assembly-sim .

# ç­‰å¾… 5-10 åˆ†é’Ÿï¼ˆé¦–æ¬¡æ„å»ºï¼‰
# æˆåŠŸåä¼šçœ‹åˆ°: Successfully tagged cae-assembly-sim:latest
```

### ç¬¬ 3 æ­¥ï¼šå¯åŠ¨å®¹å™¨

```bash
# å¯åŠ¨å®¹å™¨å¹¶æŒ‚è½½å·¥ä½œç›®å½•
docker run -dt --name cq_brain \
  -v "E:\DeepSeek_Work\test:/app" \
  cae-assembly-sim

# éªŒè¯å®¹å™¨çŠ¶æ€
docker ps | grep cq_brain
# åº”è¯¥çœ‹åˆ°å®¹å™¨æ­£åœ¨è¿è¡Œ

# æµ‹è¯•å®¹å™¨å†…å·¥å…·
docker exec cq_brain gmsh --version
docker exec cq_brain ccx --version
```

### ç¬¬ 4 æ­¥ï¼šé…ç½® AI å®¢æˆ·ç«¯

```bash
# å¦‚æœä½¿ç”¨ Claude Desktopï¼Œç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š
# Windows: %APPDATA%\Claude\claude_desktop_config.json
# macOS: ~/Library/Application Support/Claude/claude_desktop_config.json

# æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆæˆ–åˆå¹¶åˆ°ç°æœ‰é…ç½®ï¼‰ï¼š
{
  "mcpServers": {
    "cae-assembly": {
      "command": "python",
      "args": ["E:\\DeepSeek_Work\\server.py"]
    }
  }
}

# å¦‚æœä½¿ç”¨ DeepSeek æˆ–å…¶ä»– AIï¼ŒæŒ‰å…¶æ–‡æ¡£é…ç½® MCP æœåŠ¡å™¨
```

### ç¬¬ 5 æ­¥ï¼šæµ‹è¯•è¿è¡Œ

```bash
# å¯åŠ¨ MCP æœåŠ¡å™¨ï¼ˆåœ¨ PowerShell ä¸­ï¼‰
cd E:\DeepSeek_Work
python server.py

# åº”è¯¥çœ‹åˆ°æ—¥å¿—è¾“å‡ºï¼š
# [MCP] CAE Assembly MCP Server starting...
# [MCP] Work dir: E:\DeepSeek_Work\test
# [MCP] Container: cq_brain

# ä¿æŒè¿™ä¸ªçª—å£è¿è¡Œï¼Œæ‰“å¼€ AI å®¢æˆ·ç«¯å¼€å§‹ä½¿ç”¨
```

---

## ğŸ’» ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šåˆ†æç®€å•é›¶ä»¶

**å¯¹ AI è¯´ï¼š**
```
æˆ‘æœ‰ä¸€ä¸ªé›¶ä»¶ bracket.step åœ¨ test/input/ ç›®å½•ï¼Œ
å¸®æˆ‘ç”Ÿæˆæœ‰é™å…ƒç½‘æ ¼å¹¶åˆ›å»ºé™åŠ›åˆ†ææ–‡ä»¶
```

**AI ä¼šè‡ªåŠ¨æ‰§è¡Œï¼š**
```python
# 1. åˆ†ææ–‡ä»¶
create_context("/app/input/bracket.step")

# 2. ç”Ÿæˆç½‘æ ¼
generate_mesh(
    part_path="/app/input/bracket.step",
    analysis="stress",
    target_elements=50000
)

# 3. åˆ›å»ºè¾“å…¥æ–‡ä»¶
create_calculix_inp(
    mesh_file="/app/input/bracket.msh",
    analysis="stress",
    material="steel"
)

# AI è¿”å›ï¼š
"""
âœ“ ç½‘æ ¼å·²ç”Ÿæˆ: /app/input/bracket.msh (45,234 ä¸ªå•å…ƒ)
âœ“ CalculiX è¾“å…¥æ–‡ä»¶å·²åˆ›å»º: /app/input/bracket.inp
âš ï¸ è¯·æ‰‹åŠ¨ç¼–è¾‘ .inp æ–‡ä»¶ï¼Œå®šä¹‰ï¼š
   - å›ºå®šçº¦æŸèŠ‚ç‚¹é›† NFIX
   - è½½è·èŠ‚ç‚¹é›† NLOAD å’Œè½½è·å€¼
"""
```

### ç¤ºä¾‹ 2ï¼šå¤„ç†è£…é…ä½“

**å¯¹ AI è¯´ï¼š**
```
åˆ†æ engine_assembly.step (200MB)ï¼Œè¿™æ˜¯ä¸€ä¸ªå‘åŠ¨æœºè£…é…ä½“ï¼Œ
éœ€è¦è¿›è¡Œåº”åŠ›åˆ†æ
```

**AI è‡ªåŠ¨åŒ–æµç¨‹ï¼š**
```python
# Step 1: è·å–ä¸Šä¸‹æ–‡
create_context("/app/input/engine_assembly.step")
# AI æ”¶åˆ°ï¼šæ–‡ä»¶ 200MBï¼Œéœ€è¦æ‹†åˆ†

# Step 2: æ‹†åˆ†è£…é…ä½“
split_assembly(
    step_path="/app/input/engine_assembly.step",
    output_dir="/app/parts"
)

# Step 3: æ‰¹é‡ç½‘æ ¼åŒ–
batch_process(
    parts_dir="/app/parts",
    analysis="stress"
)
# ç”Ÿæˆ 50 ä¸ªé›¶ä»¶çš„ç½‘æ ¼ï¼ˆè‡ªåŠ¨é™åˆ¶æ‰¹æ¬¡ï¼‰

# Step 4: åˆ—å‡ºç»“æœ
list_files(directory="/app/meshes", pattern="*.msh")

# AI å»ºè®®ï¼š
"""
å·²å¤„ç† 50/127 ä¸ªé›¶ä»¶ï¼ˆæ‰¹æ¬¡é™åˆ¶ï¼‰
ä¸‹ä¸€æ­¥å¯ä»¥ï¼š
1. ç»§ç»­å¤„ç†å‰©ä½™é›¶ä»¶
2. æ‰‹åŠ¨å®šä¹‰å…³é”®é›¶ä»¶çš„æ¥è§¦å…³ç³»
3. åˆå¹¶ç½‘æ ¼åè¿›è¡Œæ•´ä½“åˆ†æ
"""
```

### ç¤ºä¾‹ 3ï¼šè‡ªå®šä¹‰è„šæœ¬

**å¯¹ AI è¯´ï¼š**
```
å†™ä¸€ä¸ª Python è„šæœ¬ï¼Œè‡ªåŠ¨è¯†åˆ«è£…é…ä½“ä¸­çš„èºæ “å­”ä½ç½®
```

**AI ç”Ÿæˆå¹¶æ‰§è¡Œï¼š**
```python
write_file(
    file_path="/app/scripts/find_bolt_holes.py",
    content="""
import cadquery as cq

# åŠ è½½è£…é…ä½“
assy = cq.importers.importStep('/app/input/assembly.step')

# æŸ¥æ‰¾åœ†æŸ±å­”
holes = assy.faces('<Z').edges('%CIRCLE').vals()

for i, hole in enumerate(holes):
    center = hole.Center()
    radius = hole.radius()
    print(f"Hole {i+1}: Center=({center.x:.2f}, {center.y:.2f}, {center.z:.2f}), R={radius:.2f}")
"""
)

run_python("/app/scripts/find_bolt_holes.py")
```

---

## ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šå®¹å™¨æ— æ³•å¯åŠ¨

```bash
# æ£€æŸ¥å®¹å™¨æ—¥å¿—
docker logs cq_brain

# å¦‚æœæç¤ºç«¯å£å†²çª
docker ps -a
docker rm cq_brain  # åˆ é™¤æ—§å®¹å™¨
# é‡æ–°è¿è¡Œ docker run å‘½ä»¤

# å¦‚æœæç¤ºç›®å½•æŒ‚è½½å¤±è´¥
# ç¡®ä¿è·¯å¾„æ­£ç¡®ï¼ŒWindows éœ€è¦ç”¨åŒå¼•å·
docker run -dt --name cq_brain -v "E:\DeepSeek_Work\test:/app" cae-assembly-sim
```

### é—®é¢˜ 2ï¼šMCP æœåŠ¡å™¨è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥ server.py æ˜¯å¦åœ¨è¿è¡Œ
# åº”è¯¥çœ‹åˆ° [MCP] Server starting... æ—¥å¿—

# æ£€æŸ¥ config.json è·¯å¾„æ˜¯å¦æ­£ç¡®
# Windows è·¯å¾„éœ€è¦ç”¨åŒåæ–œæ  \\ æˆ–å•æ–œæ  /

# æµ‹è¯• Docker è¿æ¥
docker exec cq_brain echo "Hello"
# åº”è¯¥è¾“å‡º Hello
```

### é—®é¢˜ 3ï¼šGmsh ç½‘æ ¼ç”Ÿæˆå¤±è´¥

```bash
# è¿›å…¥å®¹å™¨æ‰‹åŠ¨æµ‹è¯•
docker exec -it cq_brain /bin/bash
cd /app/input
gmsh bracket.step -info

# å¦‚æœæç¤ºå†…å­˜ä¸è¶³
# åœ¨ server.py ä¸­å¢å¤§ CONFIG["mesh_coarse"]
# ä¾‹å¦‚ä» 5.0 æ”¹ä¸º 10.0ï¼ˆæ›´ç²—çš„ç½‘æ ¼ï¼‰

# å¦‚æœæç¤ºå‡ ä½•é”™è¯¯
# ä½¿ç”¨ç®€åŒ–æ¨¡å¼
gmsh bracket.step -0 -string "Geometry.OCCFixDegenerated=1;"
```

### é—®é¢˜ 4ï¼šCalculiX æ±‚è§£å¤±è´¥

```bash
# æ£€æŸ¥ .inp æ–‡ä»¶æ ¼å¼
docker exec cq_brain cat /app/analyses/analysis.inp

# æ‰‹åŠ¨è¿è¡Œ CalculiX æŸ¥çœ‹è¯¦ç»†é”™è¯¯
docker exec cq_brain ccx /app/analyses/analysis

# å¸¸è§é”™è¯¯ï¼š
# - "node set not found" â†’ æ£€æŸ¥ *BOUNDARY ä¸­çš„èŠ‚ç‚¹é›†åç§°
# - "no convergence" â†’ å‡å°è½½è·æˆ–å¢åŠ å¢é‡æ­¥æ•°
# - "negative jacobian" â†’ ç½‘æ ¼è´¨é‡å·®ï¼Œé‡æ–°ç”Ÿæˆ
```

---

## âš™ï¸ é…ç½®è°ƒä¼˜

### é’ˆå¯¹å°å‹é›¶ä»¶ï¼ˆ< 10 ä¸ªé›¶ä»¶ï¼‰

```python
# åœ¨ server.py ä¸­ä¿®æ”¹ CONFIG:
CONFIG = {
    "max_file_size_mb": 100,
    "simplify_tolerance": 0.2,    # ä¿ç•™æ›´å¤šç»†èŠ‚
    "contact_tolerance": 0.005,   # æ›´ä¸¥æ ¼
    "mesh_coarse": 2.0,           # ç»†ç½‘æ ¼
    "mesh_fine": 0.2,
    "max_batch_parts": 50,
    "default_timeout": 300
}
```

### é’ˆå¯¹å¤§å‹è£…é…ä½“ï¼ˆ> 100 ä¸ªé›¶ä»¶ï¼‰

```python
CONFIG = {
    "max_file_size_mb": 50,       # å¼ºåˆ¶æ‹†åˆ†
    "simplify_tolerance": 1.0,    # æ¿€è¿›ç®€åŒ–
    "contact_tolerance": 0.05,    # æ”¾å®½å®¹å·®
    "mesh_coarse": 10.0,          # ç²—ç½‘æ ¼
    "mesh_fine": 1.0,
    "max_batch_parts": 20,        # å°æ‰¹æ¬¡
    "default_timeout": 1200       # æ›´é•¿è¶…æ—¶
}
```

### é’ˆå¯¹æ¥è§¦åˆ†æ

```python
# ç”Ÿæˆæ›´ç»†çš„æ¥è§¦é¢ç½‘æ ¼
generate_mesh(
    part_path="/app/parts/contact_surface.step",
    analysis="stress",
    target_elements=100000  # å¢åŠ å•å…ƒæ•°
)

# åœ¨ CalculiX è¾“å…¥æ–‡ä»¶ä¸­æ·»åŠ æ¥è§¦å®šä¹‰
*SURFACE INTERACTION, NAME=CONTACT_PROP
*FRICTION
0.15

*CONTACT PAIR, INTERACTION=CONTACT_PROP
MASTER_SURFACE, SLAVE_SURFACE
```

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### ç›‘æ§å®¹å™¨èµ„æºä½¿ç”¨

```bash
# å®æ—¶ç›‘æ§
docker stats cq_brain

# è¾“å‡ºç¤ºä¾‹ï¼š
# CONTAINER   CPU %   MEM USAGE / LIMIT     MEM %
# cq_brain    45%     2.3GB / 8GB          28.75%

# å¦‚æœå†…å­˜å ç”¨è¿‡é«˜ï¼ˆ> 80%ï¼‰
# è€ƒè™‘å‡å°æ‰¹å¤„ç†å¤§å°æˆ–ç½‘æ ¼å¯†åº¦
```

### æŸ¥çœ‹å¤„ç†æ—¥å¿—

```bash
# MCP æœåŠ¡å™¨æ—¥å¿—ï¼ˆåœ¨è¿è¡Œ server.py çš„ç»ˆç«¯ï¼‰
# æ‰€æœ‰æ“ä½œéƒ½ä¼šè¾“å‡ºåˆ° stderr

# Gmsh æ—¥å¿—
docker exec cq_brain cat /app/gmsh.log

# CalculiX æ—¥å¿—
docker exec cq_brain cat /app/analyses/analysis.sta
```

---

## ğŸ¯ å¼€å‘å»ºè®®

### 1. å¢åŠ è‡ªå®šä¹‰å·¥å…·

åœ¨ `server.py` ä¸­æ·»åŠ æ–°å‡½æ•°ï¼š

```python
def my_custom_tool(param1, param2):
    """ä½ çš„è‡ªå®šä¹‰åŠŸèƒ½"""
    # å®ç°é€»è¾‘
    return {"result": "success"}

# åœ¨ tools/list ä¸­æ³¨å†Œ
{
    "name": "my_tool",
    "description": "è‡ªå®šä¹‰å·¥å…·æè¿°",
    "inputSchema": {
        "type": "object",
        "properties": {
            "param1": {"type": "string"}
        },
        "required": ["param1"]
    }
}

# åœ¨ tools/call ä¸­å¤„ç†
elif name == "my_tool":
    result = my_custom_tool(args["param1"], args.get("param2"))
    send({"jsonrpc": "2.0", "id": req_id, "result": {...}})
```

### 2. é›†æˆå…¶ä»–è½¯ä»¶

```python
# ä¾‹å¦‚ï¼šæ·»åŠ  ParaView å¯è§†åŒ–
def create_paraview_script(mesh_file, result_file):
    script = f"""
from paraview.simple import *
reader = OpenDataFile('{mesh_file}')
Show(reader)
Render()
SaveScreenshot('/app/results/output.png')
"""
    return script

# åœ¨ Dockerfile ä¸­å®‰è£… ParaView
RUN apt-get install -y paraview
```

### 3. æ·»åŠ æ•°æ®åº“è®°å½•

```python
import sqlite3

def log_analysis(step_file, mesh_elements, analysis_time):
    conn = sqlite3.connect('/app/history.db')
    cursor = conn.cursor()
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS analyses
        (id INTEGER PRIMARY KEY, file TEXT, elements INTEGER, time REAL)
    ''')
    cursor.execute('INSERT INTO analyses VALUES (NULL, ?, ?, ?)',
                   (step_file, mesh_elements, analysis_time))
    conn.commit()
    conn.close()
```

---

## ğŸ“š è¿›é˜¶å­¦ä¹ èµ„æº

### Gmsh æ–‡æ¡£
- å®˜æ–¹æ‰‹å†Œ: http://gmsh.info/doc/texinfo/gmsh.html
- Python API: https://gitlab.onelab.info/gmsh/gmsh/-/tree/master/tutorials/python

### CalculiX æ–‡æ¡£
- ç”¨æˆ·æ‰‹å†Œ: http://www.dhondt.de/ccx_2.20.pdf
- ç¤ºä¾‹: http://www.calculix.de/

### CadQuery æ–‡æ¡£
- å¿«é€Ÿå…¥é—¨: https://cadquery.readthedocs.io/
- ç¤ºä¾‹åº“: https://github.com/CadQuery/cadquery/tree/master/examples

---

## âœ… æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰ç¡®è®¤ï¼š
- [ ] Docker å·²å®‰è£…å¹¶è¿è¡Œ
- [ ] Python 3.7+ å·²å®‰è£…
- [ ] å·¥ä½œç›®å½• `E:\DeepSeek_Work\test` å·²åˆ›å»º
- [ ] ä¸‰ä¸ªæ ¸å¿ƒæ–‡ä»¶å·²æ”¾ç½®ï¼šserver.py, Dockerfile, config.json
- [ ] å®¹å™¨ `cq_brain` æ­£åœ¨è¿è¡Œ
- [ ] MCP æœåŠ¡å™¨å¯ä»¥å¯åŠ¨ï¼ˆæ— æŠ¥é”™ï¼‰
- [ ] AI å®¢æˆ·ç«¯å·²é…ç½® MCP è¿æ¥

å¼€å§‹ä½¿ç”¨ï¼š
- [ ] å°†æµ‹è¯• STEP æ–‡ä»¶æ”¾åˆ° `test/input/`
- [ ] å¯¹ AI è¯´ï¼š"åˆ†æ xxx.step æ–‡ä»¶"
- [ ] æ£€æŸ¥ç”Ÿæˆçš„ç½‘æ ¼æ–‡ä»¶åœ¨ `test/meshes/`
- [ ] éªŒè¯ CalculiX è¾“å…¥æ–‡ä»¶åœ¨ `test/analyses/`

---

## ğŸ‰ æˆåŠŸï¼

ç³»ç»Ÿé…ç½®å®Œæˆåï¼Œä½ å¯ä»¥ï¼š

âœ… ç”¨è‡ªç„¶è¯­è¨€æ§åˆ¶ CAE å·¥å…·é“¾  
âœ… è‡ªåŠ¨å¤„ç†å¤æ‚è£…é…ä½“  
âœ… æ‰¹é‡ç”Ÿæˆç½‘æ ¼å’Œåˆ†ææ–‡ä»¶  
âœ… å¿«é€Ÿè¿­ä»£è®¾è®¡æ–¹æ¡ˆ  

**ä¸‹ä¸€æ­¥ï¼š** å°è¯•å¯¹ AI è¯´ï¼š"å¸®æˆ‘åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„åº”åŠ›åˆ†æå·¥ä½œæµ"